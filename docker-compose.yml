
version: '3'
services:
    gateway:
        build:
          context: ./gateway
          dockerfile: Dockerfile
        ports:
            - '80:80'
        environment:
            COMMENTS_SERVICE: comments-service:50051
        volumes:
            - "./gateway/src:/usr/src/app/src/:cached"
        networks:
            lesson_vpn:
                aliases:
                    - gateway
    comments:
        build:
          context: ./comments
          dockerfile: Dockerfile
        environment:
            MONGO_URL: mongodb://comments-db:27017
            BIND_LOCATION: comments-service:50051
        volumes:
            - "./comments/src:/usr/src/app/src/:cached"
        networks:
            comments_vpn:
            lesson_vpn:
                aliases:
                    - comments-service
    comments-db:
        image: mongo:4.2.0
        networks:
            comments_vpn:
                aliases:
                    - comments-db

networks:
    lesson_vpn:
    comments_vpn: